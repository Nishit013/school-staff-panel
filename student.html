<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Student Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1220; --surface:#151a2e; --surface-2:#1b2240; --text:#e9eefb; --muted:#a6b0cf;
    --primary:#00bcd4; --primary-2:#0097a7; --success:#21c064; --danger:#ff4f4f; --warn:#f0c419;
    --card:#151a2e; --border:#253058; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  [data-theme="light"]{
    --bg:#f6f8ff; --surface:#ffffff; --surface-2:#f3f6ff; --text:#0b1635; --muted:#47517a;
    --primary:#007c8a; --primary-2:#00a1b3; --success:#1e9c54; --danger:#e03b3b; --warn:#cc9c10;
    --card:#ffffff; --border:#e3e8ff; --shadow:0 8px 24px rgba(10,42,120,.08);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--bg); color:var(--text);
  }

  /* Navbar */
  .nav{
    position:sticky; top:0; z-index:50;
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px; background:var(--surface); border-bottom:1px solid var(--border);
  }
  .brand{display:flex; align-items:center; gap:10px; font-weight:700}
  .brand .logo{
    width:32px; height:32px; display:grid; place-items:center; border-radius:10px;
    background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:white;
    box-shadow:0 6px 16px rgba(0, 188, 212, .25);
  }

  /* Layout */
  .wrap{padding:14px; max-width:1100px; margin:0 auto}

  /* Student info card */
  .profile{
    background:var(--card); border:1px solid var(--border); border-radius:14px;
    padding:16px; margin-top:14px; box-shadow:var(--shadow);
  }
  .profile h2{margin:0 0 6px; font-size:20px}
  .profile .meta{color:var(--muted); font-size:14px}

  /* Analytics header */
  .analytics{
    display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;
  }
  .kpi{
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px;
    display:flex; align-items:center; gap:12px; box-shadow:var(--shadow);
  }
  .kpi .icon{width:40px; height:40px; border-radius:10px; display:grid; place-items:center}
  .kpi .meta{line-height:1.2}
  .kpi .val{font-size:20px; font-weight:700}
  .icon.green{background:#163222; color:#7ff0a8}
  .icon.red{background:#3b1a1a; color:#ff8a8a}
  .icon.blue{background:#0f2730; color:#8de9f6}

  /* Section */
  .section{
    margin-top:14px; background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px;
  }
  .section h3{margin:0 0 10px 0; font-size:18px}

  /* Homework list */
  .homework-list{display:grid; gap:10px}
  .homework{
    border:1px solid var(--border); border-radius:12px; padding:12px; background:var(--surface-2);
  }
  .homework .title{font-weight:600}
  .homework .date{font-size:12px; color:var(--muted); margin-top:4px}

  /* Graph */
  #attendanceChart{width:100%; height:300px; background:var(--surface-2); border-radius:12px; margin-top:10px}

  @media (min-width:680px){
    .analytics{grid-template-columns:repeat(3,1fr)}
  }
</style>
</head>
<body>
  <div class="nav">
    <div class="brand"><div class="logo">ðŸŽ“</div> Student Panel</div>
  </div>

  <div class="wrap">

    <!-- LOGIN PANEL -->
    <div id="loginPanel" class="profile">
      <h2>Student Login</h2>
      <div>
        <input type="email" id="studentEmail" placeholder="Email" style="padding:8px; width:100%; margin:5px 0; border-radius:8px;">
        <input type="password" id="studentPassword" placeholder="Password" style="padding:8px; width:100%; margin:5px 0; border-radius:8px;">
        <button class="btn primary" onclick="studentLogin()">Login</button>
        <div id="loginError" style="color:var(--danger); margin-top:8px;"></div>
      </div>
    </div>

    <!-- DASHBOARD (hidden until login) -->
    <div id="dashboard" style="display:none;">

      <!-- Profile -->
      <div class="profile">
        <h2 id="studentName">Student Name</h2>
        <div class="meta">Class: <span id="studentClass">--</span></div>
        <div class="meta">Email: <span id="studentEmailShow">--</span></div>
        <button class="btn ghost" onclick="logout()">Logout</button>
      </div>

      <!-- KPIs -->
      <div class="analytics">
        <div class="kpi"><div class="icon green">âœ”</div><div><div class="meta">Total Present</div><div id="kpiPresent" class="val">0</div></div></div>
        <div class="kpi"><div class="icon red">âœ–</div><div><div class="meta">Total Absent</div><div id="kpiAbsent" class="val">0</div></div></div>
        <div class="kpi"><div class="icon blue">%</div><div><div class="meta">Attendance %</div><div id="kpiPercent" class="val">0%</div></div></div>
      </div>

      <!-- Attendance Graph -->
      <div class="section">
        <h3>Attendance This Month</h3>
        <canvas id="attendanceChart"></canvas>
      </div>

      <!-- Homework Section -->
      <div class="section">
        <h3>Latest Homework</h3>
        <div class="homework-list" id="homeworkList"></div>
      </div>
    </div>
  </div>
</body>
  <div class="footer-space"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // 1. Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCfffexgO1rf6m6EteNNtFb_kZnRqqTUBM",
      authDomain: "schoolmanagementsystem-32895.firebaseapp.com",
      databaseURL: "https://schoolmanagementsystem-32895-default-rtdb.firebaseio.com",
      projectId: "schoolmanagementsystem-32895",
      storageBucket: "schoolmanagementsystem-32895.appspot.com",
      messagingSenderId: "837516759841",
      appId: "1:837516759841:web:31d6666b15037082fa6460"
    };

  // 2. Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentStudent = null;

  // 3. Add your login handler here (signInWithEmailAndPassword)
  async function loginStudent() {
  const email = document.getElementById("studentEmail").value;
  const password = document.getElementById("studentPassword").value;
  try {
    await auth.signInWithEmailAndPassword(email, password);
  } catch (error) {
    alert("Login Failed: " + error.message);
  }
}


  // 4. ðŸ”‘ Your given code â†’ Listen for auth state changes
  
  // Listen for login/logout state changes
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      currentStudent = user;

      // fetch student data from database
      const snap = await db.ref(`users/${user.uid}`).once('value');
      const userData = snap.val();

      if (userData && userData.role === "student") {
        // show student info
        document.getElementById('studentName').textContent = userData.name;
        document.getElementById('studentClass').textContent = userData.class;
        document.getElementById('studentEmailShow').textContent = userData.email;

        // hide login, show dashboard
        document.getElementById('loginPanel').style.display = "none";
        document.getElementById('dashboard').style.display = "block";

        // load attendance + homework
        loadAttendance(userData.class, user.uid);
        loadHomework(userData.class);
      } else {
        document.getElementById('loginError').textContent = "Not a student account!";
        await auth.signOut();
      }
    } else {
      // no one logged in â†’ show login page
      document.getElementById('loginPanel').style.display = "block";
      document.getElementById('dashboard').style.display = "none";
    }
  });

  // Logout function
  function logout() {
    auth.signOut();
  }
</script>



  // Load Attendance for student
  async function loadAttendance(className, studentUID) {
    const snap = await db.ref(`attendance/${className}`).once('value');
    const data = snap.val() || {};

    let totalDays = 0, present = 0, absent = 0;
    const monthlyCounts = {};

    Object.keys(data).forEach(date => {
      const status = data[date][studentUID];
      if (!status) return;
      totalDays++;
      if (status === "Present") present++;
      if (status === "Absent") absent++;

      const monthKey = date.slice(0,7); // YYYY-MM
      if(!monthlyCounts[monthKey]) monthlyCounts[monthKey] = { present:0, total:0 };
      monthlyCounts[monthKey].total++;
      if(status==="Present") monthlyCounts[monthKey].present++;
    });

    document.getElementById('totalDays').textContent = totalDays;
    document.getElementById('daysPresent').textContent = present;
    document.getElementById('daysAbsent').textContent = absent;

    // Draw Chart
    const labels = Object.keys(monthlyCounts).sort();
    const dataPoints = labels.map(m => Math.round((monthlyCounts[m].present / monthlyCounts[m].total)*100));
    const ctx = document.getElementById('attendanceChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: '% Attendance',
          data: dataPoints,
          backgroundColor: 'rgba(54, 162, 235, 0.6)'
        }]
      },
      options: { responsive:true, scales:{y:{beginAtZero:true, max:100}} }
    });
  }

  // Load Homework
  function loadHomework(className) {
  db.ref(`homework/${className}`).on('value', (snap) => {
    const data = snap.val() || {};
    const tbody = document.querySelector('#homeworkTable tbody');
    tbody.innerHTML = '';

    const sortedDates = Object.keys(data).sort((a,b)=> new Date(b) - new Date(a));
    sortedDates.forEach(date => {
      const hw = data[date];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${date}</td>
        <td>${hw}</td>
      `;
      tbody.appendChild(tr);
    });
  });
}

</script>

</body>
</html>
